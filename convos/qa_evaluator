import os
import json

# Directory containing the files
QA_FOLDER = "QAs_after_conversations"
EVALUATE_BUYER_SELLER = False
EVALUATE_THERAPIST_PATIENT = False
EVALUATE_CHITCHAT = True

def evaluate_qa(persona_type_1, persona_type_2):
    # Iterate through all JSON files in the folder
    for filename in os.listdir(QA_FOLDER):
        if filename.endswith(".json"):
            # Extract indices from the filename
            parts = filename.split('_')
            if not ((parts[0] == persona_type_1 and parts[2] == persona_type_2) or (parts[0] == "chitchat" and persona_type_1 == "chitchat")):
                print(parts[0], persona_type_1)
                continue
            if (len(parts) >= 6) and not parts[0] == "chitchat":
                i, j, k, l = parts[1], parts[3], parts[5], parts[6]
                persona_name1 = persona_type_1
                persona_name2 = persona_type_2
            elif (parts[0] == "chitchat"):
                print(parts)
                i, j, k, l = parts[1], parts[2], parts[4], parts[5]
                persona_name1 = "group1 persona"
                persona_name2 = "group2 persona"
            else:
                print(f"Unexpected filename format: {filename}")
                continue
            filepath = os.path.join(QA_FOLDER, filename)
            with open(filepath, 'r') as file:
                qa_data = json.load(file)
                
                # Iterate through QA sets
                for persona_idx, persona_qa in enumerate(qa_data):
                    for question_idx, qa in enumerate(persona_qa):
                        answer = qa.get("answer")
                        given_answer = qa.get("given answer").replace(".","")
                        persona_type = [persona_name1, persona_name2]
                        # Compare answer and given answer
                        if answer == "":
                            print(f"{i} {j} {k} {l} {persona_type[persona_idx]} Question {question_idx} :")
                            print(f"NULL\n")
                            continue                            
                        if answer != given_answer:
                            print(f"{i} {j} {k} {l} {persona_type[persona_idx]} Question {question_idx} :")
                            print(f"answer: {answer}")
                            print(f"given answer: {given_answer}\n")

# Run the function

if EVALUATE_BUYER_SELLER:
    evaluate_qa("buyer","seller")
if EVALUATE_THERAPIST_PATIENT:
    evaluate_qa("therapist","patient")
if EVALUATE_CHITCHAT:
    evaluate_qa("chitchat","")